#!/usr/bin/python3

from subprocess import Popen, PIPE

#command to test sudo command CVE-2021-3156 vulnerability
#sudoedit -s $(perl -e 'print "A"x65535 . "\\"')
shell_command = '''sudoedit -s $(perl -e 'print "A"x65535 . "\\\\"')'''

print("[*] Executing sudoedit -s command with overflow payloads.")
#checking CVE-2021-3156 vulnerability on sudoedit -s
proc = Popen(shell_command, shell=True, stdout=PIPE, stderr=PIPE)
out, err = proc.communicate()

if("Segmentation fault" in err.decode()):
	print("[!] The current sudo version was vulnerable to CVE-2021-3156.", end="\n\n")
	print("[important] Please use CVE-2021-3156_patcher.sh to patch the vulnerability.")
else:
	print("[*] The current sudo version are safe from CVE-2021-3156.")