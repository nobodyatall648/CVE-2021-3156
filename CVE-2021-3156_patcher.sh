#!/bin/bash

echo "[*] Downloading sudo 1.9.5p2.tar.gz"
echo
wget -O "/tmp/sudo-1.9.5p2.tar.gz" https://www.sudo.ws/dist/sudo-1.9.5p2.tar.gz
echo

echo "[*] Extracting sudo-1.9.5p2.tar.gz file"
echo
cd /tmp
tar -xzvf /tmp/sudo-1.9.5p2.tar.gz
cd /tmp/sudo-1.9.5p2
echo

echo "[*] Installing sudo-1.9.5p2"
echo
./configure
echo 
make && sudo make install
echo

echo "[*] Checking sudo version"
echo
if bash -c "sudo -V" | grep -q '1.9.5p2'; then
	echo "[*] CVE-2021-3156 vulnerability has been patched."
else
	echo "[!] Patch unsuccessful, something went wrong during the patch."
fi

echo

echo "[*] Removing tar file & uncompressed directory"
cd  /tmp
rm sudo-1.9.5p2.tar.gz
rm -rf ./sudo-1.9.5p2

echo "[*] Patch Script Executed Completely."
